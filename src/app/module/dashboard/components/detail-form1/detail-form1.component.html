<div class="card ">
  <div class="card-header ">
    <button class="btn btn-danger" (click)="onBack()">
      <i class="fa fa-arrow-right"></i>
      <span class="ml-2">بازگشت</span>
    </button>
    <button class="btn btn-success ml-2 " *ngIf="permisson.CanApprove" (click)="onApprove()">
      <span class="mr-2">  تایید </span>
      <i class="fa fa-check"></i>
    </button>
    <button class="btn btn-warning ml-2 " *ngIf="permisson.CanClose" (click)="onClose()">
      <span class="mr-2">  close</span>
      <i class="fa fa-check"></i>
    </button>
    <button class="btn btn-primary ml-2 " *ngIf="permisson.CanEdit" >
      <span class="mr-2"> edit</span>
      <i class="fa fa-check"></i>
    </button>
    <button class="btn btn-info ml-2 " *ngIf="permisson.CanFinalize" >
      <span class="mr-2"> Finalize</span>
      <i class="fa fa-check"></i>
    </button>
    <button class="btn btn-danger ml-2 " *ngIf="permisson.CanReject" (click)="CanReject()">
      <span class="mr-2">Reject</span>
      <i class="fa fa-check"></i>
    </button>
    <button class="btn btn-success ml-2 " *ngIf="permisson.CanStart">
      <span class="mr-2"> Start</span>
      <i class="fa fa-check"></i>
    </button>
  </div>
  <div class="card-body ">
    <form #f='ngForm'>

      <div class="row">
        <div class="col-md-12">
          <label>شرایط عمومی مناقصه</label>
        </div>
        <div class="panel-shadow">
          <div class="col-md-12">
            <div class="row">
              <div class="col-md-4">
                <div class="form-group ">
                  <label class="">نوع حضور :</label>
                  <mat-select [(ngModel)]="DataModel.HozurTypeID" disabled
                              name="HozurTypeID" required (selectionChange)="onChangeHozure($event)">
                    <mat-option></mat-option>
                    <mat-option *ngFor="let item of HozurType"
                                [value]="item.ID">{{item.PersianTitle}}</mat-option>
                  </mat-select>

                </div>
              </div>

              <div class="col-md-4" *ngIf="DataModel.HozurTypeID !== 1">
                <div class="form-group ">
                  <label class="field-require">معرف :</label>
                  <mat-select [(ngModel)]="DataModel.MonagheseGozar" disabled
                              name="MonagheseGozar" required>
                    <mat-option></mat-option>
                    <mat-option *ngFor="let item of MonagheseGozarType"
                                [value]="item.ID">{{item.PersianTitle}}</mat-option>
                  </mat-select>

                </div>
              </div>

              <div class="col-md-4">
                <div class="form-group ">
                  <label class="field-require">نام مناقصه گذار :</label>
                  <input type="text" disabled class="form-control round" name="MonagheseGozar"
                         [(ngModel)]="DataModel.MonagheseGozar"
                         required>

                </div>
              </div>

              <div class="col-md-4">
                <div class="form-group ">
                  <label class="field-require">موضوع مناقصه : </label>

                  <input type="text" disabled class="form-control round" name="MonaghesTopic"
                         [(ngModel)]="DataModel.MonaghesTopic"
                         required>

                </div>
              </div>


              <div class="col-md-4">
                <div class="form-group ">
                  <label class="field-require">شماره مناقصه : </label>
                  <input type="text" class="form-control round" disabled
                         oninput="this.value=this.value.replace(/[^0-9]/g,'');"
                         name="PeopleNum"
                         [(ngModel)]="DataModel.PeopleNum"
                         required>

                </div>
              </div>
              <div class="col-md-4">
                <div class="form-group ">
                  <label class="field-require"> نوع مناقصه گذار : </label>
                  <mat-select [(ngModel)]="DataModel.MonagheseGozarTypeID" disabled
                              name="MonagheseGozarTypeID" required>
                    <mat-option *ngFor="let items of MonagheseGozarTypes"
                                [value]="items.ID">{{items.PersianTitle}}</mat-option>
                  </mat-select>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-group ">
                  <label class="field-require">شناسه ملی :</label>
                  <input type="text" disabled
                         oninput="this.value=this.value.replace(/[^0-9]/g,'');"
                         class="form-control round" name="ShenaseMeliInt" [(ngModel)]="DataModel.ShenaseMeliInt"
                         required>


                </div>
              </div>
              <div class="col-md-4">
                <div class="form-group ">
                  <label class="field-require"> کد اقتصادی : </label>
                  <input type="text" disabled
                         oninput="this.value=this.value.replace(/[^0-9]/g,'');"
                         class="form-control round" name="EghtesadiCodeInt" [(ngModel)]="DataModel.EghtesadiCodeInt"
                         required>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-group ">
                  <label class="field-require">استان :</label>
                  <mat-select [(ngModel)]="DataModel.AddressOstanID" disabled
                              name="AddressOstanID" required>
                    <mat-option>انتخاب کنید</mat-option>
                    <mat-option *ngFor="let items of OstansType"
                                [value]="items.ID">{{items.PersianTitle}}</mat-option>
                  </mat-select>

                </div>
              </div>
              <div class="col-md-4">
                <div class="form-group ">
                  <label class="field-require"> شهر : </label>
                  <mat-select [(ngModel)]="DataModel.AddressCityID" disabled
                              name="AddressCityID" required>
                    <mat-option>انتخاب کنید</mat-option>
                    <mat-option *ngFor="let items of CitiesType"
                                [value]="items.ID">{{items.PersianTitle}}</mat-option>
                  </mat-select>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-group ">
                  <label class="field-require"> آدرس : </label>
                  <input type="text" class="form-control round"
                         name="AddressDetail"
                         [(ngModel)]="DataModel.AddressDetail" disabled
                         required>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-group ">
                  <label class="field-require">پیش شماره :</label>
                  <mat-select [(ngModel)]="DataModel.PhonePrefix" disabled
                              name="PhonePrefix" required>
                    <mat-option>انتخاب کنید</mat-option>
                    <mat-option *ngFor="let items of PhonePrefixType"
                                [value]="items.ID">{{items.Value}}</mat-option>
                  </mat-select>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-group ">
                  <label class="field-require"> تلفن : </label>
                  <input type="text" class="form-control round"
                         name="Phone"
                         [(ngModel)]="DataModel.Phone" disabled
                         required>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-group ">
                  <label class="field-require"> کد پستی : </label>
                  <input type="text" class="form-control round"
                         name="Code"
                         [(ngModel)]="DataModel.Code" disabled
                         required>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-group ">
                  <label class="field-require">حق پرتفوی کلی : </label>

                  <input type="text" disabled
                         oninput="this.value=this.value.replace(/[^0-9]/g,'');"
                         mask="separator.2" thousandSeparator=","
                         class="form-control round" name="HodudePortofaKoli"
                         [(ngModel)]="DataModel.HodudePortofaKoli"
                         required>

                </div>
              </div>


              <div class="col-md-4">
                <div class="form-group ">
                  <label class="field-require">تاریخ برگزاری مناقصه : </label>
                    <input class="form-control"   [(ngModel)]="DataModel.BaragorzariDate" disabled
                         name="BaragorzariDate">
                  <!--<dp-date-picker-->
                    <!--[(ngModel)]="DataModel.BaragorzariDate" disabled-->
                    <!--name="BaragorzariDate"-->
                    <!--dir="ltr"-->
                    <!--required-->
                    <!--class="form-control"-->
                    <!--mode="day"-->
                    <!--theme="dp-material"-->
                    <!--[config]="showFormat">-->
                  <!--</dp-date-picker>-->
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-group ">
                  <label class="field-require"> مهلت نهایی اعلام حق بیمه : </label>
                  <input class="form-control"   [(ngModel)]="DataModel.MohlatElamHagheBimeDate"
                         name="MohlatElamHagheBimeDate" disabled>
                  <!--<dp-date-picker-->
                    <!--[(ngModel)]="DataModel.MohlatElamHagheBimeDate"-->
                    <!--name="MohlatElamHagheBimeDate"-->
                    <!--dir="ltr"-->
                    <!--required disabled-->
                    <!--class="form-control"-->
                    <!--mode="day"-->
                    <!--theme="dp-material"-->
                    <!--[config]="showFormat">-->
                  <!--</dp-date-picker>-->
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-group ">
                  <label class="field-require">
                    وضعیت شهرت شرکت مناقصه گذار در زمینه خسارت رشته های مورد نظر :
                  </label>
                  <mat-select [(ngModel)]="DataModel.ShohratKhesaratMonagheseGozar" disabled
                              name="ShohratKhesaratMonagheseGozar" required>
                    <mat-option *ngFor="let items of ShohratKhesaratType"
                                [value]="items.ID">{{items.PersianTitle}}</mat-option>
                  </mat-select>

                </div>
              </div>
              <div class="col-md-4">
                <div class="form-group ">
                  <label class="field-require"> رقبای اصلی : </label>
                  <div class="row">
                    <div class="col-md-3">
                      <button class="btn btn-info btn-select" disabled (click)="openModal(modal2)">
                        انتخاب کنید
                      </button>
                    </div>
                    <div class="col-md-9">
                      <input class="form-control" disabled [(ngModel)]="rogabaAsliTitleInput" name="ragib">

                    </div>
                  </div>
                </div>
              </div>

            </div>
            <div class="row">
              <div class="col-md-12">
                <table class="table table-bordered">
                  <thead>
                  <tr>
                    <th>گروه بیمه</th>
                    <th>تعداد افراد</th>
                    <th>رشته بیمه</th>
                    <th>حق بیمه پیشنهادی</th>
                    <th>بیمه گر سال گذشته</th>
                    <th>سابقه خسارت سنوات گذشته مناقصه گذار</th>
                    <th>توضیحات</th>
                    <th>
                      <button class="btn btn-action bg-success mr-1" data-toggle="tooltip" title="ایجاد" disabled
                              (click)="openModal(content)">
                        <i class="fa fa-plus"></i>
                      </button>
                    </th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr *ngFor="let item of gridHamraz; let i = index ">
                    <td>{{item.HagheBimeTypeTile}}</td>
                    <td>{{item.PersonNumber}}</td>
                    <td>{{item.BimeFieldIDTitle}}</td>
                    <td>{{item.HagheBimeAmount}}</td>
                    <td>{{item.LastYearBimeGarIDTitle}}</td>
                    <td>{{item.SabegheKhesaratPercent}}</td>
                    <td>{{item.Comment}}</td>
                    <td>
                      <button class="btn btn-action bg-danger  mr-1" disabled data-toggle="tooltip" title="حذف"
                              (click)="removeFromSabtGrid(i)">
                        <i class="fa fa-trash-alt"></i>
                      </button>
                    </td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-12 two">
          <label>شرایط ضمانت مناقصه</label>
        </div>
        <div class="panel-shadow">
          <div class="col-md-12">
            <div class="form-group row ">
              <label class="field-require mr-3">نیاز به ضمانت نامه/سپرده دارد :</label>
              <mat-slide-toggle name="NeedWarranty" disabled [(ngModel)]="NeedWarranty">
              </mat-slide-toggle>
            </div>
          </div>
        </div>

        <div class="col-md-12" *ngIf="NeedWarranty">
          <div class="row">
            <div class="col-md-12 two">
              <label>اطلاعات ضمانت مناقصه</label>
            </div>
            <div class="panel-shadow">
              <div class="col-md-12">
                <div class="row">
                  <div class="col-md-4">
                    <div class="form-group ">
                      <label class="field-require">مبلغ ضمانت نامه/سپرده :</label>
                      <input type="text" disabled
                             oninput="this.value=this.value.replace(/[^0-9]/g,'');"
                             mask="separator.2" thousandSeparator=","
                             class="form-control round" name="WarrantyAmount" [(ngModel)]="DataModel.WarrantyAmount"
                             required>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-group ">
                      <label class="field-require"> تاریخ سررسید : </label>
                      <input class="form-control"   [(ngModel)]="DataModel.SarresidDate"
                             name="SarresidDate" disabled>
                      <!--<dp-date-picker-->
                        <!--disabled-->
                        <!--[(ngModel)]="DataModel.SarresidDate"-->
                        <!--name="SarresidDate"-->
                        <!--dir="ltr"-->
                        <!--required-->
                        <!--class="form-control"-->
                        <!--mode="day"-->
                        <!--theme="dp-material"-->
                        <!--[config]="showFormat">-->
                      <!--</dp-date-picker>-->
                    </div>
                  </div>


                  <div class="col-md-4">
                    <div class="form-group ">
                      <label class="field-require">نوع ضمانت نامه :</label>
                      <mat-select [(ngModel)]="DataModel.WarrantyTypeId" disabled
                                  name="WarrantyTypeId" required>
                        <mat-option *ngFor="let items of WarrantyTypes"
                                    [value]="items.ID">{{items.PersianTitle}}</mat-option>
                      </mat-select>

                    </div>
                  </div>
                </div>
              </div>
            </div>


            <div class="col-md-12 two">
              <label>اطلاعات ذینفع</label>
            </div>
            <div class="panel-shadow">
              <div class="col-md-12">
                <div class="row">


                  <div class="col-md-4">
                    <div class="form-group ">
                      <label class="field-require">نام بانک مناقصه گذار
                        :</label>
                      <input type="text" class="form-control round"
                             name="MonagheseGozarBank"
                             [(ngModel)]="DataModel.MonagheseGozarBank" disabled
                             required>

                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-group ">
                      <label class="field-require"> کد شعبه
                        : </label>
                      <input type="text" class="form-control round"
                             oninput="this.value=this.value.replace(/[^0-9]/g,'');"
                             name="BranchCode" disabled
                             [(ngModel)]="DataModel.BranchCode" required>
                    </div>
                  </div>

                  <div class="col-md-4">
                    <div class="form-group ">
                      <label class="field-require">نام شعبه :</label>
                      <input type="text" class="form-control round"
                             name="BranchName"
                             [(ngModel)]="DataModel.BranchName" disabled
                             required>

                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-group ">
                      <label class="field-require"> شماره حساب : </label>
                      <input type="text" class="form-control round"
                             oninput="this.value=this.value.replace(/[^0-9]/g,'');"
                             name="AccountNumberInt" disabled
                             [(ngModel)]="DataModel.AccountNumberInt" required>
                    </div>
                  </div>

                  <div class="col-md-4">
                    <div class="form-group ">
                      <label class="field-require"> شماره شبا :</label>
                      <input type="text" class="form-control form-control-position-input"
                             oninput="this.value=this.value.replace(/[^0-9]/g,'');"
                             name="ShabaNumber"
                             [(ngModel)]="DataModel.ShabaNumber" disabled
                             required>
                      <div class="form-control-position">
                        <span>-IR</span>
                      </div>

                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-group ">
                      <label class="field-require"> به نام : </label>
                      <input type="text" class="form-control round"
                             name="ZinafName" disabled
                             [(ngModel)]="DataModel.ZinafName" required>
                    </div>
                  </div>
                </div>
              </div>
            </div>


          </div>
          <!--<div class="row">-->
            <!--<div class="col-md-12 two">-->
              <!--<label>پیوست های مناقصه</label>-->
            <!--</div>-->
            <!--<div class="panel-shadow">-->
              <!--<div class="col-md-12">-->
                <!--<app-dpk-form-upload disabled-->
                                     <!--name="upload"-->
                                     <!--(fileData)="onUploadFile($event)"-->
                                     <!--[label]="'پیوست کلیه صفحات'"-->
                                     <!--[uploadInput]="'حجم فایل نباید بیشتر از 10 مگ باشد'"-->
                <!--&gt;</app-dpk-form-upload>-->
              <!--</div>-->
            <!--</div>-->
          <!--</div>-->
        </div>
      </div>
    </form>

  </div>
</div>


<ng-template #content let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title"> همراز </h4>
  </div>
  <div class="modal-body">
    <form (ngSubmit)="saveModal(f , content)" #f=ngForm>
      <div class="row">
        <div class="col-md-12">
          <div class="form-group ">
            <label class="field-require">گروه بیمه : </label>
            <mat-select ngModel
                        (selectionChange)="onChangeBimeGroup($event)"
                        name="HagheBimeType" required>
              <mat-option *ngFor="let item of BimeGroupsType"
                          [value]="item.ID">{{item.PersianTitle}}</mat-option>
            </mat-select>
          </div>
        </div>
        <div class="col-md-12 mt-1">
          <div class="form-group ">
            <label class="field-require">تعداد افراد : </label>
            <input type="text" ngModel required
                   oninput="this.value=this.value.replace(/[^0-9]/g,'');"
                   name="PersonNumber" class="form-control">
          </div>
        </div>
        <div class="col-md-12 mt-1">
          <label>رشته بیمه :</label>
          <mat-select ngModel
                      name="BimeFieldID" required (selectionChange)="onChangeReshteBime($event)">
            <mat-option>انتخاب کنید</mat-option>
            <mat-option *ngFor="let items of BimefieldType"
                        [value]="items.ID">{{items.PersianTitle}}</mat-option>
          </mat-select>
        </div>
        <div class="col-md-12 mt-1">
          <label>حق بیمه پیشنهادی :</label>
          <input class="form-control"
                 mask="separator.2" thousandSeparator=","
                 oninput="this.value=this.value.replace(/[^0-9]/g,'');"
                 name="HagheBimeAmount" ngModel>
        </div>
        <div class="col-md-12 mt-1">
          <label>بیمه گر سال گذشته :</label>
          <ng-autocomplete
            [data]="BimeGarsType"
            name="LastYearBimeGarID"
            [searchKeyword]="keyword"
            (selected)='selectEvent($event)'
            (inputChanged)='onChangeSearch($event)'
            (inputFocused)='onFocused($event)'
            [itemTemplate]="itemTemplate"
            [notFoundTemplate]="notFoundTemplate">
          </ng-autocomplete>
        </div>
        <div class="col-md-12 mt-1">
          <label>سابقه خسارت سنوات گذشته مناقصه گذار :</label>
          <input class="form-control" name="SabegheKhesaratPercent" ngModel>
        </div>
        <div class="col-md-12 mt-1">
          <label>توضیحات :</label>
          <input class="form-control" name="Comment" ngModel>
        </div>
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button type="submit" class="btn btn-success m-1" (click)="saveModal(f , content)">ذخیره</button>
    <button type="button" class="btn btn-danger m-1" (click)="onCloseModal(content)">انصراف</button>
  </div>
</ng-template>

<ng-template #modal2 let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title">رقبای اصلی</h4>
  </div>
  <div class="modal-body">
    <form #f=ngForm>
      <div class="row">
        <div class="col-md-4" *ngFor="let item of BimeGarsType">
          <input type="checkbox" (change)="onChnageChackbox($event)" value="{{item.ID}}">
          <label>{{item.PersianTitle}}</label>
        </div>
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-danger m-1 w-100" (click)="onCloseModal(modal2)">بستن</button>
  </div>
</ng-template>
<ng-template #itemTemplate let-item>
  <a [innerHTML]="item.PersianTitle"></a>
</ng-template>

<ng-template #notFoundTemplate let-notFound>
  <div [innerHTML]="'مقدار مورد نظر وجود ندارد'"></div>
</ng-template>
